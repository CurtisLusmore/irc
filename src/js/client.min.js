/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';
	
	var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };
	
	var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();
	
	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
	
	var net = __webpack_require__(1);
	
	/**
	 * Split a string with the given separator at most n times.
	 * @param {str} The string to split.
	 * @param {sep} The separator to split on.
	 * @param {n} The maximum number of splits to make.
	 * @return An array of substrings.
	 */
	function split(str, sep, n) {
	    if (sep === undefined) {
	        sep = ' ';
	    }
	    if (n === undefined) {
	        n = 1;
	    }
	    var items = [];
	    while (n-- > 0 && str.length > 0) {
	        var index = str.indexOf(sep);
	        var item = str.substring(0, index);
	        str = str.substring(index + sep.length);
	        items.push(item);
	    }
	    if (str.length > 0) items.push(str);
	    return items;
	}
	
	/**
	 * Create a new event. The event has a subscribe method and a notify method.
	 *
	 * The subscribe method returns a callable which will unsubscribe when called,
	 * and can also have its subscribe method called to make further subscriptions.
	 * The subscribe methods take two function handles, the first is the callback
	 * which is called when the event is notified, the second is a predicate which
	 * must return true if the callback is to be invoked. The second argument is
	 * optional, if missing the callback is always called.
	 *
	 * The notify method takes any number of arguments and notifies all subscribers
	 * by calling the predicate and callback functions with the supplied arguments.
	 *
	 * @return A new event.
	 */
	function event() {
	    var subscribers = {};
	    var nextId = 0;
	    return {
	        subscribe: function subscribe(handler, predicate) {
	            var ids = [];
	            var unsubscriber = function unsubscriber() {
	                for (var ind in ids) {
	                    delete subscribers[ids[ind]];
	                }
	            };
	            unsubscriber.subscribe = function (handler, predicate) {
	                var id = nextId++;
	                ids.push(id);
	                subscribers[id] = {
	                    handler: handler,
	                    predicate: predicate || function () {
	                        return true;
	                    }
	                };
	                return this;
	            };
	            unsubscriber.subscribe(handler, predicate);
	            return unsubscriber;
	        },
	        notify: function notify() {
	            for (var id in subscribers) {
	                var subscriber = subscribers[id];
	                if (subscriber.predicate.apply(null, arguments)) {
	                    subscriber.handler.apply(null, arguments);
	                }
	            }
	        }
	    };
	}
	
	/**
	 * A class representing an IRC client. Allows sending and receiving of messages
	 * to/from an IRC server.
	 */
	
	var IrcClient = function () {
	    /**
	     * Create a new IRC client.
	     * @param {host} The hostname of the server to connect to.
	     * @param {port} The port number of the server to connect to.
	     */
	
	    function IrcClient(host, port) {
	        var _this = this;
	
	        _classCallCheck(this, IrcClient);
	
	        var socket = new net.Socket();
	        socket.setEncoding('ascii');
	        socket.connect({
	            host: host,
	            port: port
	        });
	        socket.on('data', function (data) {
	            return _this.receiveData(data);
	        });
	
	        this.socket = socket;
	        this.buffer = '';
	        this.recvEvent = event();
	    }
	
	    /**
	     * Subscribe to messages received by the IRC server.
	     * @param {target} The target message/s to subscribe to. If a string,
	     *     matches messages of the supplied command. If a list, matches
	     *     messages of any of the supplied commands. If a predicate, matches
	     *     messages whose command satisfies the predicate.
	     * @param {handler} The callback function. Receives the message, prefix and
	     *     command.
	     * @return A callable to unsubscribe.
	     */
	
	
	    _createClass(IrcClient, [{
	        key: 'subscribe',
	        value: function subscribe(target, handler) {
	            var predicate;
	            switch (typeof target === 'undefined' ? 'undefined' : _typeof(target)) {
	                case 'string':
	                    predicate = function predicate(msg, pre, cmd) {
	                        return target === cmd;
	                    };
	                    break;
	                case 'object':
	                    predicate = function predicate(msg, pre, cmd) {
	                        return target.includes(cmd);
	                    };
	                    break;
	                default:
	                    predicate = target;
	                    break;
	            }
	            this.recvEvent.subscribe(handler, predicate);
	            return this;
	        }
	
	        /**
	         * Send a message to the IRC server.
	         * @param {message} The message to send.
	         */
	
	    }, {
	        key: 'sendMessage',
	        value: function sendMessage(message) {
	            console.log('<<< ' + message);
	            this.socket.write(message + '\r\n');
	            return this;
	        }
	
	        /**
	         * Send a command to the IRC server, by joining the array of arguments
	         * with spaces.
	         * @param {arguments} The arguments that make up the command.
	         */
	
	    }, {
	        key: 'sendCommand',
	        value: function sendCommand() {
	            var args = Array.apply(null, arguments);
	            this.sendMessage(args.join(' '));
	            return this;
	        }
	    }, {
	        key: 'receiveData',
	        value: function receiveData(data) {
	            this.buffer += data;
	            var index;
	            while (this.buffer.length > 0 && (index = this.buffer.indexOf('\n')) !== -1) {
	                var message = this.buffer.substring(0, index);
	                this.buffer = this.buffer.substring(index + 1);
	                this.receiveMessage(message);
	            }
	        }
	    }, {
	        key: 'receiveMessage',
	        value: function receiveMessage(message) {
	            console.log('>>> ' + message);
	
	            var res = split(message);
	            var token = res[0];
	            message = res[1];
	            var prefix, command;
	            if (token[0] === ':') {
	                prefix = token;
	                res = split(message);
	                command = res[0];
	                message = res[1];
	            } else {
	                prefix = null;
	                command = token;
	            }
	
	            this.recvEvent.notify(message, prefix, command);
	        }
	    }]);
	
	    return IrcClient;
	}();
	
	/**
	 * Parse the given user mask to create a user object.
	 * @param {mask} The user mask.
	 * @return A user object containing the mask, nick, user, domain and a HTML
	 *     span.
	 */
	
	
	function makeUser(mask) {
	    var res = split(mask, '!');
	    var nick = res[0].substring(1);
	    res = split(res[1], '@');
	    var span = document.createElement('span');
	    span.innerText = nick;
	    span.className = 'tooltip';
	    var tooltip = document.createElement('span');
	    tooltip.innerText = mask;
	    tooltip.className = 'tooltiptext';
	    span.appendChild(tooltip);
	    return {
	        mask: mask,
	        nick: nick,
	        user: res[0].substring(1),
	        domain: res[1],
	        span: span
	    };
	}
	
	/**
	 * Class representing a form-backed IRC client.
	 */
	
	var Client = function () {
	    /**
	     * Create a new client and the form that provides its input and output.
	     * @param {container} The container element to add the form to.
	     */
	
	    function Client(container) {
	        var _this2 = this;
	
	        _classCallCheck(this, Client);
	
	        var form = document.createElement('form');
	        form.className = 'client';
	        var output = document.createElement('div');
	        output.className = 'client-output';
	        output.disabled = true;
	        form.appendChild(output);
	        var input = document.createElement('input');
	        input.className = 'client-input';
	        input.autofocus = true;
	        input.placeholder = 'JOIN #channel';
	        form.appendChild(input);
	        form.onsubmit = function () {
	            return _this2.sendMessage();
	        };
	        container.appendChild(form);
	
	        var client = new IrcClient('chat.freenode.net', 6667);
	        client.subscribe('PING', function (msg) {
	            client.sendCommand('PONG', msg);
	        }).subscribe('NOTICE', function (msg) {
	            var res = split(msg);
	            var recipient = res[0];
	            var message = res[1].substring(1);
	            _this2.writeMessage(message);
	        })
	        // .subscribe(['001', '002', '003'], msg => { // Welcome
	        //     var res = split(msg);
	        //     var message = res[1].substring(1);
	        //     this.writeMessage(message);
	        // })
	        // .subscribe(['004', '005'], msg => { // info
	        //     var res = split(msg);
	        //     var message = res[1];
	        //     this.writeMessage(message);
	        // })
	        .subscribe(['353', '366'], function (msg) {
	            // NAMES
	            var res = split(msg, ' ', 2);
	            var message = res[2];
	            _this2.writeMessage(message);
	        }).subscribe(['432', '433', '451'], function (msg) {
	            // ERR_NICKNAMEINUSE
	            var res = split(msg);
	            var message = res[1];
	            _this2.writeMessage(message);
	        }).subscribe(['704', '705', '706'], function (msg) {
	            // HELP
	            var res = split(msg, ' ', 2);
	            var msg = res[2].substring(1).trim();
	            if (msg !== '') _this2.writeMessage(msg);
	        }).subscribe('QUIT', function (msg, pre) {
	            var user = makeUser(pre);
	            _this2.writeMessage(user.span, ' has quit: ' + msg.substring(1));
	        }).subscribe('JOIN', function (msg, pre) {
	            var user = makeUser(pre);
	            _this2.writeMessage(user.span, ' has joined ' + msg);
	        }).subscribe('PART', function (msg, pre) {
	            var user = makeUser(pre);
	            _this2.writeMessage(user.span, ' has left ' + msg);
	        }).subscribe('NICK', function (msg, pre) {
	            var user = makeUser(pre);
	            _this2.writeMessage(user.span, ' has changed nicknames to ' + msg);
	        }).subscribe('PRIVMSG', function (msg, pre) {
	            var res = split(msg);
	            var channel = res[0];
	            var message = res[1].substring(1);
	            var user = makeUser(pre);
	            _this2.writeMessage(channel + ': ', user.span, ': ' + message);
	        });
	        client.sendCommand('PASS', 'curtispassword').sendCommand('NICK', 'curtis52').sendCommand('USER', 'curtis52', '0', '*', 'curtis');
	
	        this.form = form;
	        this.input = input;
	        this.output = output;
	        this.client = client;
	    }
	
	    /**
	     * Send a message to the IRC server.
	     * @param {arguments} The components of the message to send.
	     */
	
	
	    _createClass(Client, [{
	        key: 'sendMessage',
	        value: function sendMessage() {
	            var message = this.input.value;
	            this.input.value = '';
	
	            this.client.sendMessage(message);
	            return false;
	        }
	
	        /**
	         * Write a message to the form output. Adds all arguments to a container
	         * element which represents a single message.
	         * @param {arguments} The components of the message.
	         */
	
	    }, {
	        key: 'writeMessage',
	        value: function writeMessage() {
	            if (arguments.length === 1 && arguments[0] === '') {
	                console.log('empty');
	            }
	            var elem = document.createElement('div');
	            for (var ind in arguments) {
	                var argument = arguments[ind];
	                elem.appendChild(argument instanceof HTMLElement ? argument : document.createTextNode(argument));
	            }
	            return this.writeElement(elem);
	        }
	
	        /**
	         * Write a HTML element to the form output.
	         * @param {elem} A HTML element.
	         */
	
	    }, {
	        key: 'writeElement',
	        value: function writeElement(elem) {
	            var scrollToBottom = this.output.scrollTop + this.output.clientHeight + 1 >= this.output.scrollHeight;
	
	            var container = document.createElement('div');
	            container.className = 'client-message';
	            var date = document.createElement('div');
	            date.innerText = new Date().toLocaleTimeString();
	            date.className = 'client-message-timestamp';
	            container.appendChild(date);
	            container.appendChild(elem);
	            this.output.appendChild(container);
	
	            if (scrollToBottom) {
	                this.output.scrollTop = this.output.scrollHeight;
	            }
	            return this;
	        }
	    }]);
	
	    return Client;
	}();
	
	(function () {
	    new Client(document.getElementById('app'));
	})();

/***/ },
/* 1 */
/***/ function(module, exports) {

	module.exports = require("net");

/***/ }
/******/ ]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgN2YxYzg3ZGYyMWQxNmMwNDZkYTkiLCJ3ZWJwYWNrOi8vLy4vanMvY2xpZW50LmpzIiwid2VicGFjazovLy9leHRlcm5hbCBcIm5ldFwiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOzs7Ozs7O0FDdENBOzs7Ozs7OztBQUVBLEtBQU0sTUFBTSxvQkFBUSxDQUFSLENBQU47Ozs7Ozs7OztBQVNOLFVBQVMsS0FBVCxDQUFlLEdBQWYsRUFBb0IsR0FBcEIsRUFBeUIsQ0FBekIsRUFBNEI7QUFDeEIsU0FBSSxRQUFRLFNBQVIsRUFBbUI7QUFBRSxlQUFNLEdBQU4sQ0FBRjtNQUF2QjtBQUNBLFNBQUksTUFBTSxTQUFOLEVBQWlCO0FBQUUsYUFBSSxDQUFKLENBQUY7TUFBckI7QUFDQSxTQUFJLFFBQVEsRUFBUixDQUhvQjtBQUl4QixZQUFPLE1BQU0sQ0FBTixJQUFXLElBQUksTUFBSixHQUFhLENBQWIsRUFBZ0I7QUFDOUIsYUFBSSxRQUFRLElBQUksT0FBSixDQUFZLEdBQVosQ0FBUixDQUQwQjtBQUU5QixhQUFJLE9BQU8sSUFBSSxTQUFKLENBQWMsQ0FBZCxFQUFpQixLQUFqQixDQUFQLENBRjBCO0FBRzlCLGVBQU0sSUFBSSxTQUFKLENBQWMsUUFBTSxJQUFJLE1BQUosQ0FBMUIsQ0FIOEI7QUFJOUIsZUFBTSxJQUFOLENBQVcsSUFBWCxFQUo4QjtNQUFsQztBQU1BLFNBQUksSUFBSSxNQUFKLEdBQWEsQ0FBYixFQUFnQixNQUFNLElBQU4sQ0FBVyxHQUFYLEVBQXBCO0FBQ0EsWUFBTyxLQUFQLENBWHdCO0VBQTVCOzs7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LENBUGU7QUFRZix1QkFBVSxXQUFWLENBQXNCLElBQXRCLEVBUmU7QUFTZix1QkFBVSxXQUFWLENBQXNCLElBQXRCLEVBVGU7QUFVZixrQkFBSyxNQUFMLENBQVksV0FBWixDQUF3QixTQUF4QixFQVZlOztBQVlmLGlCQUFJLGNBQUosRUFBb0I7QUFBRSxzQkFBSyxNQUFMLENBQVksU0FBWixHQUF3QixLQUFLLE1BQUwsQ0FBWSxZQUFaLENBQTFCO2NBQXBCO0FBQ0Esb0JBQU8sSUFBUCxDQWJlOzs7O1lBM0hqQjs7O0FBNElOLEVBQUMsWUFBVztBQUNSLFNBQUksTUFBSixDQUFXLFNBQVMsY0FBVCxDQUF3QixLQUF4QixDQUFYLEVBRFE7RUFBWCxHQUFELEM7Ozs7OztBQzFWQSxpQyIsImZpbGUiOiIuL2pzL2NsaWVudC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcblxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0ZXhwb3J0czoge30sXG4gXHRcdFx0aWQ6IG1vZHVsZUlkLFxuIFx0XHRcdGxvYWRlZDogZmFsc2VcbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIHdlYnBhY2svYm9vdHN0cmFwIDdmMWM4N2RmMjFkMTZjMDQ2ZGE5XG4gKiovIiwiJ3VzZSBzdHJpY3QnXHJcblxyXG5jb25zdCBuZXQgPSByZXF1aXJlKCduZXQnKTtcclxuXHJcbi8qKlxyXG4gKiBTcGxpdCBhIHN0cmluZyB3aXRoIHRoZSBnaXZlbiBzZXBhcmF0b3IgYXQgbW9zdCBuIHRpbWVzLlxyXG4gKiBAcGFyYW0ge3N0cn0gVGhlIHN0cmluZyB0byBzcGxpdC5cclxuICogQHBhcmFtIHtzZXB9IFRoZSBzZXBhcmF0b3IgdG8gc3BsaXQgb24uXHJcbiAqIEBwYXJhbSB7bn0gVGhlIG1heGltdW0gbnVtYmVyIG9mIHNwbGl0cyB0byBtYWtlLlxyXG4gKiBAcmV0dXJuIEFuIGFycmF5IG9mIHN1YnN0cmluZ3MuXHJcbiAqL1xyXG5mdW5jdGlvbiBzcGxpdChzdHIsIHNlcCwgbikge1xyXG4gICAgaWYgKHNlcCA9PT0gdW5kZWZpbmVkKSB7IHNlcCA9ICcgJzsgfVxyXG4gICAgaWYgKG4gPT09IHVuZGVmaW5lZCkgeyBuID0gMTsgfVxyXG4gICAgdmFyIGl0ZW1zID0gW107XHJcbiAgICB3aGlsZSAobi0tID4gMCAmJiBzdHIubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHZhciBpbmRleCA9IHN0ci5pbmRleE9mKHNlcCk7XHJcbiAgICAgICAgdmFyIGl0ZW0gPSBzdHIuc3Vic3RyaW5nKDAsIGluZGV4KTtcclxuICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKGluZGV4K3NlcC5sZW5ndGgpO1xyXG4gICAgICAgIGl0ZW1zLnB1c2goaXRlbSk7XHJcbiAgICB9XHJcbiAgICBpZiAoc3RyLmxlbmd0aCA+IDApIGl0ZW1zLnB1c2goc3RyKTtcclxuICAgIHJldHVybiBpdGVtcztcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhIG5ldyBldmVudC4gVGhlIGV2ZW50IGhhcyBhIHN1YnNjcmliZSBtZXRob2QgYW5kIGEgbm90aWZ5IG1ldGhvZC5cclxuICpcclxuICogVGhlIHN1YnNjcmliZSBtZXRob2QgcmV0dXJucyBhIGNhbGxhYmxlIHdoaWNoIHdpbGwgdW5zdWJzY3JpYmUgd2hlbiBjYWxsZWQsXHJcbiAqIGFuZCBjYW4gYWxzbyBoYXZlIGl0cyBzdWJzY3JpYmUgbWV0aG9kIGNhbGxlZCB0byBtYWtlIGZ1cnRoZXIgc3Vic2NyaXB0aW9ucy5cclxuICogVGhlIHN1YnNjcmliZSBtZXRob2RzIHRha2UgdHdvIGZ1bmN0aW9uIGhhbmRsZXMsIHRoZSBmaXJzdCBpcyB0aGUgY2FsbGJhY2tcclxuICogd2hpY2ggaXMgY2FsbGVkIHdoZW4gdGhlIGV2ZW50IGlzIG5vdGlmaWVkLCB0aGUgc2Vjb25kIGlzIGEgcHJlZGljYXRlIHdoaWNoXHJcbiAqIG11c3QgcmV0dXJuIHRydWUgaWYgdGhlIGNhbGxiYWNrIGlzIHRvIGJlIGludm9rZWQuIFRoZSBzZWNvbmQgYXJndW1lbnQgaXNcclxuICogb3B0aW9uYWwsIGlmIG1pc3NpbmcgdGhlIGNhbGxiYWNrIGlzIGFsd2F5cyBjYWxsZWQuXHJcbiAqXHJcbiAqIFRoZSBub3RpZnkgbWV0aG9kIHRha2VzIGFueSBudW1iZXIgb2YgYXJndW1lbnRzIGFuZCBub3RpZmllcyBhbGwgc3Vic2NyaWJlcnNcclxuICogYnkgY2FsbGluZyB0aGUgcHJlZGljYXRlIGFuZCBjYWxsYmFjayBmdW5jdGlvbnMgd2l0aCB0aGUgc3VwcGxpZWQgYXJndW1lbnRzLlxyXG4gKlxyXG4gKiBAcmV0dXJuIEEgbmV3IGV2ZW50LlxyXG4gKi9cclxuZnVuY3Rpb24gZXZlbnQoKSB7XHJcbiAgICB2YXIgc3Vic2NyaWJlcnMgPSB7fTtcclxuICAgIHZhciBuZXh0SWQgPSAwO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBzdWJzY3JpYmU6IGZ1bmN0aW9uIChoYW5kbGVyLCBwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgdmFyIGlkcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgdW5zdWJzY3JpYmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kIGluIGlkcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBzdWJzY3JpYmVyc1tpZHNbaW5kXV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHVuc3Vic2NyaWJlci5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoaGFuZGxlciwgcHJlZGljYXRlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBuZXh0SWQrKztcclxuICAgICAgICAgICAgICAgIGlkcy5wdXNoKGlkKTtcclxuICAgICAgICAgICAgICAgIHN1YnNjcmliZXJzW2lkXSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiBoYW5kbGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIHByZWRpY2F0ZTogcHJlZGljYXRlIHx8ICgoKSA9PiB0cnVlKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB1bnN1YnNjcmliZXIuc3Vic2NyaWJlKGhhbmRsZXIsIHByZWRpY2F0ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiB1bnN1YnNjcmliZXI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBub3RpZnk6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaWQgaW4gc3Vic2NyaWJlcnMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdWJzY3JpYmVyID0gc3Vic2NyaWJlcnNbaWRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHN1YnNjcmliZXIucHJlZGljYXRlLmFwcGx5KG51bGwsIGFyZ3VtZW50cykpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmhhbmRsZXIuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBIGNsYXNzIHJlcHJlc2VudGluZyBhbiBJUkMgY2xpZW50LiBBbGxvd3Mgc2VuZGluZyBhbmQgcmVjZWl2aW5nIG9mIG1lc3NhZ2VzXHJcbiAqIHRvL2Zyb20gYW4gSVJDIHNlcnZlci5cclxuICovXHJcbmNsYXNzIElyY0NsaWVudCB7XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZSBhIG5ldyBJUkMgY2xpZW50LlxyXG4gICAgICogQHBhcmFtIHtob3N0fSBUaGUgaG9zdG5hbWUgb2YgdGhlIHNlcnZlciB0byBjb25uZWN0IHRvLlxyXG4gICAgICogQHBhcmFtIHtwb3J0fSBUaGUgcG9ydCBudW1iZXIgb2YgdGhlIHNlcnZlciB0byBjb25uZWN0IHRvLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3Rvcihob3N0LCBwb3J0KSB7XHJcbiAgICAgICAgdmFyIHNvY2tldCA9IG5ldyBuZXQuU29ja2V0KCk7XHJcbiAgICAgICAgc29ja2V0LnNldEVuY29kaW5nKCdhc2NpaScpO1xyXG4gICAgICAgIHNvY2tldC5jb25uZWN0KHtcclxuICAgICAgICAgICAgaG9zdDogaG9zdCxcclxuICAgICAgICAgICAgcG9ydDogcG9ydFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHNvY2tldC5vbignZGF0YScsIGRhdGEgPT4gdGhpcy5yZWNlaXZlRGF0YShkYXRhKSk7XHJcblxyXG4gICAgICAgIHRoaXMuc29ja2V0ID0gc29ja2V0O1xyXG4gICAgICAgIHRoaXMuYnVmZmVyID0gJyc7XHJcbiAgICAgICAgdGhpcy5yZWN2RXZlbnQgPSBldmVudCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaWJlIHRvIG1lc3NhZ2VzIHJlY2VpdmVkIGJ5IHRoZSBJUkMgc2VydmVyLlxyXG4gICAgICogQHBhcmFtIHt0YXJnZXR9IFRoZSB0YXJnZXQgbWVzc2FnZS9zIHRvIHN1YnNjcmliZSB0by4gSWYgYSBzdHJpbmcsXHJcbiAgICAgKiAgICAgbWF0Y2hlcyBtZXNzYWdlcyBvZiB0aGUgc3VwcGxpZWQgY29tbWFuZC4gSWYgYSBsaXN0LCBtYXRjaGVzXHJcbiAgICAgKiAgICAgbWVzc2FnZXMgb2YgYW55IG9mIHRoZSBzdXBwbGllZCBjb21tYW5kcy4gSWYgYSBwcmVkaWNhdGUsIG1hdGNoZXNcclxuICAgICAqICAgICBtZXNzYWdlcyB3aG9zZSBjb21tYW5kIHNhdGlzZmllcyB0aGUgcHJlZGljYXRlLlxyXG4gICAgICogQHBhcmFtIHtoYW5kbGVyfSBUaGUgY2FsbGJhY2sgZnVuY3Rpb24uIFJlY2VpdmVzIHRoZSBtZXNzYWdlLCBwcmVmaXggYW5kXHJcbiAgICAgKiAgICAgY29tbWFuZC5cclxuICAgICAqIEByZXR1cm4gQSBjYWxsYWJsZSB0byB1bnN1YnNjcmliZS5cclxuICAgICAqL1xyXG4gICAgc3Vic2NyaWJlKHRhcmdldCwgaGFuZGxlcikge1xyXG4gICAgICAgIHZhciBwcmVkaWNhdGU7XHJcbiAgICAgICAgc3dpdGNoICh0eXBlb2YodGFyZ2V0KSkge1xyXG4gICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxyXG4gICAgICAgICAgICAgICAgcHJlZGljYXRlID0gKG1zZywgcHJlLCBjbWQpID0+IHRhcmdldCA9PT0gY21kO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XHJcbiAgICAgICAgICAgICAgICBwcmVkaWNhdGUgPSAobXNnLCBwcmUsIGNtZCkgPT4gdGFyZ2V0LmluY2x1ZGVzKGNtZCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHByZWRpY2F0ZSA9IHRhcmdldDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlY3ZFdmVudC5zdWJzY3JpYmUoaGFuZGxlciwgcHJlZGljYXRlKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNlbmQgYSBtZXNzYWdlIHRvIHRoZSBJUkMgc2VydmVyLlxyXG4gICAgICogQHBhcmFtIHttZXNzYWdlfSBUaGUgbWVzc2FnZSB0byBzZW5kLlxyXG4gICAgICovXHJcbiAgICBzZW5kTWVzc2FnZShtZXNzYWdlKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYDw8PCAke21lc3NhZ2V9YCk7XHJcbiAgICAgICAgdGhpcy5zb2NrZXQud3JpdGUobWVzc2FnZSArICdcXHJcXG4nKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNlbmQgYSBjb21tYW5kIHRvIHRoZSBJUkMgc2VydmVyLCBieSBqb2luaW5nIHRoZSBhcnJheSBvZiBhcmd1bWVudHNcclxuICAgICAqIHdpdGggc3BhY2VzLlxyXG4gICAgICogQHBhcmFtIHthcmd1bWVudHN9IFRoZSBhcmd1bWVudHMgdGhhdCBtYWtlIHVwIHRoZSBjb21tYW5kLlxyXG4gICAgICovXHJcbiAgICBzZW5kQ29tbWFuZCgpIHtcclxuICAgICAgICB2YXIgYXJncyA9IEFycmF5LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZShhcmdzLmpvaW4oJyAnKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcmVjZWl2ZURhdGEoZGF0YSkge1xyXG4gICAgICAgIHRoaXMuYnVmZmVyICs9IGRhdGE7XHJcbiAgICAgICAgdmFyIGluZGV4O1xyXG4gICAgICAgIHdoaWxlICh0aGlzLmJ1ZmZlci5sZW5ndGggPiAwICYmIChpbmRleCA9IHRoaXMuYnVmZmVyLmluZGV4T2YoJ1xcbicpKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSB0aGlzLmJ1ZmZlci5zdWJzdHJpbmcoMCwgaW5kZXgpO1xyXG4gICAgICAgICAgICB0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLnN1YnN0cmluZyhpbmRleCsxKTtcclxuICAgICAgICAgICAgdGhpcy5yZWNlaXZlTWVzc2FnZShtZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVjZWl2ZU1lc3NhZ2UobWVzc2FnZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGA+Pj4gJHttZXNzYWdlfWApO1xyXG5cclxuICAgICAgICB2YXIgcmVzID0gc3BsaXQobWVzc2FnZSk7XHJcbiAgICAgICAgdmFyIHRva2VuID0gcmVzWzBdO1xyXG4gICAgICAgIG1lc3NhZ2UgPSByZXNbMV07XHJcbiAgICAgICAgdmFyIHByZWZpeCwgY29tbWFuZDtcclxuICAgICAgICBpZiAodG9rZW5bMF0gPT09ICc6Jykge1xyXG4gICAgICAgICAgICBwcmVmaXggPSB0b2tlbjtcclxuICAgICAgICAgICAgcmVzID0gc3BsaXQobWVzc2FnZSk7XHJcbiAgICAgICAgICAgIGNvbW1hbmQgPSByZXNbMF07XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPSByZXNbMV07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcHJlZml4ID0gbnVsbDtcclxuICAgICAgICAgICAgY29tbWFuZCA9IHRva2VuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5yZWN2RXZlbnQubm90aWZ5KG1lc3NhZ2UsIHByZWZpeCwgY29tbWFuZCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQYXJzZSB0aGUgZ2l2ZW4gdXNlciBtYXNrIHRvIGNyZWF0ZSBhIHVzZXIgb2JqZWN0LlxyXG4gKiBAcGFyYW0ge21hc2t9IFRoZSB1c2VyIG1hc2suXHJcbiAqIEByZXR1cm4gQSB1c2VyIG9iamVjdCBjb250YWluaW5nIHRoZSBtYXNrLCBuaWNrLCB1c2VyLCBkb21haW4gYW5kIGEgSFRNTFxyXG4gKiAgICAgc3Bhbi5cclxuICovXHJcbmZ1bmN0aW9uIG1ha2VVc2VyKG1hc2spIHtcclxuICAgIHZhciByZXMgPSBzcGxpdChtYXNrLCAnIScpO1xyXG4gICAgdmFyIG5pY2sgPSByZXNbMF0uc3Vic3RyaW5nKDEpO1xyXG4gICAgcmVzID0gc3BsaXQocmVzWzFdLCAnQCcpO1xyXG4gICAgdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICBzcGFuLmlubmVyVGV4dCA9IG5pY2s7XHJcbiAgICBzcGFuLmNsYXNzTmFtZSA9ICd0b29sdGlwJztcclxuICAgIHZhciB0b29sdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgdG9vbHRpcC5pbm5lclRleHQgPSBtYXNrO1xyXG4gICAgdG9vbHRpcC5jbGFzc05hbWUgPSAndG9vbHRpcHRleHQnO1xyXG4gICAgc3Bhbi5hcHBlbmRDaGlsZCh0b29sdGlwKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbWFzazogbWFzayxcclxuICAgICAgICBuaWNrOiBuaWNrLFxyXG4gICAgICAgIHVzZXI6IHJlc1swXS5zdWJzdHJpbmcoMSksXHJcbiAgICAgICAgZG9tYWluOiByZXNbMV0sXHJcbiAgICAgICAgc3Bhbjogc3BhblxyXG4gICAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENsYXNzIHJlcHJlc2VudGluZyBhIGZvcm0tYmFja2VkIElSQyBjbGllbnQuXHJcbiAqL1xyXG5jbGFzcyBDbGllbnQge1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgYSBuZXcgY2xpZW50IGFuZCB0aGUgZm9ybSB0aGF0IHByb3ZpZGVzIGl0cyBpbnB1dCBhbmQgb3V0cHV0LlxyXG4gICAgICogQHBhcmFtIHtjb250YWluZXJ9IFRoZSBjb250YWluZXIgZWxlbWVudCB0byBhZGQgdGhlIGZvcm0gdG8uXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHZhciBmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9ybScpO1xyXG4gICAgICAgIGZvcm0uY2xhc3NOYW1lID0gJ2NsaWVudCc7XHJcbiAgICAgICAgdmFyIG91dHB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIG91dHB1dC5jbGFzc05hbWUgPSAnY2xpZW50LW91dHB1dCc7XHJcbiAgICAgICAgb3V0cHV0LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICBmb3JtLmFwcGVuZENoaWxkKG91dHB1dCk7XHJcbiAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgICAgICBpbnB1dC5jbGFzc05hbWUgPSAnY2xpZW50LWlucHV0JztcclxuICAgICAgICBpbnB1dC5hdXRvZm9jdXMgPSB0cnVlO1xyXG4gICAgICAgIGlucHV0LnBsYWNlaG9sZGVyID0gJ0pPSU4gI2NoYW5uZWwnO1xyXG4gICAgICAgIGZvcm0uYXBwZW5kQ2hpbGQoaW5wdXQpO1xyXG4gICAgICAgIGZvcm0ub25zdWJtaXQgPSAoKSA9PiB0aGlzLnNlbmRNZXNzYWdlKCk7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZvcm0pO1xyXG5cclxuICAgICAgICB2YXIgY2xpZW50ID0gbmV3IElyY0NsaWVudCgnY2hhdC5mcmVlbm9kZS5uZXQnLCA2NjY3KTtcclxuICAgICAgICBjbGllbnRcclxuICAgICAgICAgICAgLnN1YnNjcmliZSgnUElORycsIG1zZyA9PiB7XHJcbiAgICAgICAgICAgICAgICBjbGllbnQuc2VuZENvbW1hbmQoJ1BPTkcnLCBtc2cpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCdOT1RJQ0UnLCBtc2cgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IHNwbGl0KG1zZyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVjaXBpZW50ID0gcmVzWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSByZXNbMV0uc3Vic3RyaW5nKDEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy53cml0ZU1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC8vIC5zdWJzY3JpYmUoWycwMDEnLCAnMDAyJywgJzAwMyddLCBtc2cgPT4geyAvLyBXZWxjb21lXHJcbiAgICAgICAgICAgIC8vICAgICB2YXIgcmVzID0gc3BsaXQobXNnKTtcclxuICAgICAgICAgICAgLy8gICAgIHZhciBtZXNzYWdlID0gcmVzWzFdLnN1YnN0cmluZygxKTtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMud3JpdGVNZXNzYWdlKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAvLyB9KVxyXG4gICAgICAgICAgICAvLyAuc3Vic2NyaWJlKFsnMDA0JywgJzAwNSddLCBtc2cgPT4geyAvLyBpbmZvXHJcbiAgICAgICAgICAgIC8vICAgICB2YXIgcmVzID0gc3BsaXQobXNnKTtcclxuICAgICAgICAgICAgLy8gICAgIHZhciBtZXNzYWdlID0gcmVzWzFdO1xyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy53cml0ZU1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICAgICAgICAgIC8vIH0pXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoWyczNTMnLCAnMzY2J10sIG1zZyA9PiB7IC8vIE5BTUVTXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gc3BsaXQobXNnLCAnICcsIDIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSByZXNbMl07XHJcbiAgICAgICAgICAgICAgICB0aGlzLndyaXRlTWVzc2FnZShtZXNzYWdlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN1YnNjcmliZShbJzQzMicsICc0MzMnLCAnNDUxJ10sIG1zZyA9PiB7IC8vIEVSUl9OSUNLTkFNRUlOVVNFXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gc3BsaXQobXNnKTtcclxuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gcmVzWzFdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy53cml0ZU1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoWyc3MDQnLCAnNzA1JywgJzcwNiddLCBtc2cgPT4geyAvLyBIRUxQXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gc3BsaXQobXNnLCAnICcsIDIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9IHJlc1syXS5zdWJzdHJpbmcoMSkudHJpbSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1zZyAhPT0gJycpIHRoaXMud3JpdGVNZXNzYWdlKG1zZyk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoJ1FVSVQnLCAobXNnLCBwcmUpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciB1c2VyID0gbWFrZVVzZXIocHJlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMud3JpdGVNZXNzYWdlKHVzZXIuc3BhbiwgYCBoYXMgcXVpdDogJHttc2cuc3Vic3RyaW5nKDEpfWApO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCdKT0lOJywgKG1zZywgcHJlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IG1ha2VVc2VyKHByZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLndyaXRlTWVzc2FnZSh1c2VyLnNwYW4sIGAgaGFzIGpvaW5lZCAke21zZ31gKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN1YnNjcmliZSgnUEFSVCcsIChtc2csIHByZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHVzZXIgPSBtYWtlVXNlcihwcmUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy53cml0ZU1lc3NhZ2UodXNlci5zcGFuLCBgIGhhcyBsZWZ0ICR7bXNnfWApO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCdOSUNLJywgKG1zZywgcHJlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IG1ha2VVc2VyKHByZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLndyaXRlTWVzc2FnZSh1c2VyLnNwYW4sIGAgaGFzIGNoYW5nZWQgbmlja25hbWVzIHRvICR7bXNnfWApO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCdQUklWTVNHJywgKG1zZywgcHJlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gc3BsaXQobXNnKTtcclxuICAgICAgICAgICAgICAgIHZhciBjaGFubmVsID0gcmVzWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSByZXNbMV0uc3Vic3RyaW5nKDEpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVzZXIgPSBtYWtlVXNlcihwcmUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy53cml0ZU1lc3NhZ2UoYCR7Y2hhbm5lbH06IGAsIHVzZXIuc3BhbiwgYDogJHttZXNzYWdlfWApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICBjbGllbnRcclxuICAgICAgICAgICAgLnNlbmRDb21tYW5kKCdQQVNTJywgJ2N1cnRpc3Bhc3N3b3JkJylcclxuICAgICAgICAgICAgLnNlbmRDb21tYW5kKCdOSUNLJywgJ2N1cnRpczUyJylcclxuICAgICAgICAgICAgLnNlbmRDb21tYW5kKCdVU0VSJywgJ2N1cnRpczUyJywgJzAnLCAnKicsICdjdXJ0aXMnKTtcclxuXHJcbiAgICAgICAgdGhpcy5mb3JtID0gZm9ybTtcclxuICAgICAgICB0aGlzLmlucHV0ID0gaW5wdXQ7XHJcbiAgICAgICAgdGhpcy5vdXRwdXQgPSBvdXRwdXQ7XHJcbiAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZW5kIGEgbWVzc2FnZSB0byB0aGUgSVJDIHNlcnZlci5cclxuICAgICAqIEBwYXJhbSB7YXJndW1lbnRzfSBUaGUgY29tcG9uZW50cyBvZiB0aGUgbWVzc2FnZSB0byBzZW5kLlxyXG4gICAgICovXHJcbiAgICBzZW5kTWVzc2FnZSgpIHtcclxuICAgICAgICB2YXIgbWVzc2FnZSA9IHRoaXMuaW5wdXQudmFsdWU7XHJcbiAgICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9ICcnO1xyXG5cclxuICAgICAgICB0aGlzLmNsaWVudC5zZW5kTWVzc2FnZShtZXNzYWdlKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBXcml0ZSBhIG1lc3NhZ2UgdG8gdGhlIGZvcm0gb3V0cHV0LiBBZGRzIGFsbCBhcmd1bWVudHMgdG8gYSBjb250YWluZXJcclxuICAgICAqIGVsZW1lbnQgd2hpY2ggcmVwcmVzZW50cyBhIHNpbmdsZSBtZXNzYWdlLlxyXG4gICAgICogQHBhcmFtIHthcmd1bWVudHN9IFRoZSBjb21wb25lbnRzIG9mIHRoZSBtZXNzYWdlLlxyXG4gICAgICovXHJcbiAgICB3cml0ZU1lc3NhZ2UoKSB7XHJcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgYXJndW1lbnRzWzBdID09PSAnJykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZW1wdHknKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBmb3IgKHZhciBpbmQgaW4gYXJndW1lbnRzKSB7XHJcbiAgICAgICAgICAgIHZhciBhcmd1bWVudCA9IGFyZ3VtZW50c1tpbmRdO1xyXG4gICAgICAgICAgICBlbGVtLmFwcGVuZENoaWxkKGFyZ3VtZW50IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyBhcmd1bWVudCA6IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGFyZ3VtZW50KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLndyaXRlRWxlbWVudChlbGVtKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFdyaXRlIGEgSFRNTCBlbGVtZW50IHRvIHRoZSBmb3JtIG91dHB1dC5cclxuICAgICAqIEBwYXJhbSB7ZWxlbX0gQSBIVE1MIGVsZW1lbnQuXHJcbiAgICAgKi9cclxuICAgIHdyaXRlRWxlbWVudChlbGVtKSB7XHJcbiAgICAgICAgdmFyIHNjcm9sbFRvQm90dG9tID0gdGhpcy5vdXRwdXQuc2Nyb2xsVG9wICsgdGhpcy5vdXRwdXQuY2xpZW50SGVpZ2h0ICsgMSA+PSB0aGlzLm91dHB1dC5zY3JvbGxIZWlnaHQ7XHJcblxyXG4gICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gJ2NsaWVudC1tZXNzYWdlJztcclxuICAgICAgICB2YXIgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGRhdGUuaW5uZXJUZXh0ID0gbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKTtcclxuICAgICAgICBkYXRlLmNsYXNzTmFtZSA9ICdjbGllbnQtbWVzc2FnZS10aW1lc3RhbXAnO1xyXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkYXRlKTtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZWxlbSk7XHJcbiAgICAgICAgdGhpcy5vdXRwdXQuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcclxuXHJcbiAgICAgICAgaWYgKHNjcm9sbFRvQm90dG9tKSB7IHRoaXMub3V0cHV0LnNjcm9sbFRvcCA9IHRoaXMub3V0cHV0LnNjcm9sbEhlaWdodDsgfVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG59XHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICBuZXcgQ2xpZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAnKSk7XHJcbn0oKSk7XG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9qcy9jbGllbnQuanNcbiAqKi8iLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJuZXRcIik7XG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiBleHRlcm5hbCBcIm5ldFwiXG4gKiogbW9kdWxlIGlkID0gMVxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIl0sInNvdXJjZVJvb3QiOiIifQ==